Usage
=====

Running the Application
-----------------------

After installing dependencies with Poetry, you can run the application using Poetry's ``run`` command, which executes commands within the project's virtual environment:

.. code-block:: bash

   poetry run bokeh serve --show iechelle/gui/main.py

This will typically open the application in a new browser tab.

GUI Overview
------------

The main interface is within the "Mode Selection" tab, which provides tools for:

*   **File Loading:**
    *   Loading observed periodograms from FITS files.
    *   Loading peak-bagging parameter files (``.pkb``).
    *   Loading background parameter files for synthetic spectrum calculation.
*   **Periodogram Display:**
    *   Interactive periodogram plot.
    *   Selection of frequency regions and modes.
    *   Thresholding for peak identification.
*   **Echelle Diagram Display:**
    *   Interactive echelle diagram.
    *   Controls for ``delta Nu`` (large frequency separation) via a slider.
    *   Controls for color stretch of the echelle diagram.
    *   Visualization of selected modes on the diagram.
*   **Mode Selection Tables:**
    *   Tables to display and manage selected oscillation mode frequencies and parameters.
    *   Buttons to move modes between tables (e.g., from a temporary selection to a final list).
    *   Saving and loading mode lists.
*   **Synthetic Spectrum:**
    *   Calculation and display of synthetic power spectra based on loaded parameters.
    *   Comparison with observed spectra.

Input File Formats
------------------

*   **Periodograms:** Standard FITS files where the first extension's data contains two columns: frequency and power.
*   **Peak-bagging Files (``.pkb``):** Text files containing parameters of identified oscillation modes. These are typically generated by other tools or by saving selections within iEchelle. The format is compatible with the Apollinaire library.
*   **Background Parameter Files:** Text files containing parameters describing the background noise in the periodogram, used for synthetic spectrum generation.

Core GUI Modules (`iechelle/gui/`)
------------------------------------
*   **`main.py`:** The entry point for the Bokeh application. It sets up the main layout and tabs.
*   **`env.py` (`Environment` class):** A central class that holds shared data, Bokeh ``ColumnDataSource`` objects, figure handles, UI element states, and global parameters used across different modules of the GUI.
*   **`catalog.py` (`Catalog` class):** Manages loading and interaction with astronomical catalog data, FITS file selection, and navigation between different sources.
*   **`mode_selection.py` (`Interactive` class):** Contains the core logic for the interactive echelle diagram, periodogram analysis, mode identification, selection, and interaction with synthetic spectra. This is the most complex part of the GUI.
*   **`functions.py`:** Provides utility functions, notably ``calculate_synthetic_spectrum`` which uses the Apollinaire library to generate synthetic PSDs.
