# iEchelle - Interactive Echelle Diagram Tool

## Overview

iEchelle is a Python-based graphical user interface (GUI) application designed for the interactive analysis of stellar oscillations, primarily for asteroseismology. It allows users to load periodogram data from FITS files, visualize and interact with echelle diagrams and periodograms, identify and select stellar oscillation modes, manage these selections, and compare observational data with synthetic spectra.

The tool is built using the Bokeh library for interactive plotting and UI elements.

## License

This project is licensed under the **GNU Lesser General Public License v2.1 (LGPL-2.1)**. See the `LICENSE` file for more details.

## Dependencies

The application requires the following Python libraries:

*   **Bokeh**: For the interactive GUI and plotting.
*   **NumPy**: For numerical operations.
*   **Pandas**: For data manipulation, especially with tables.
*   **Astropy**: For handling astronomical data units and FITS files.
*   **Lightkurve**: For periodogram objects and potentially other seismology tools.
*   **Apollinaire**: For synthetic spectrum calculations and echelle diagram helper functions.
*   **Tkinter**: For native file/directory dialogs (usually included with standard Python installations).
*   **Matplotlib**: Used by Apollinaire and potentially other dependencies for plotting backends or utilities.

## Installation

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd iechelle-project-directory
    ```
2.  **Create a Python environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    ```
3.  **Install dependencies:**
    Create a `requirements.txt` file with the following content:
    This project uses Poetry for dependency management and packaging. Ensure you have Poetry installed. You can install it following the instructions on the [official Poetry website](https://python-poetry.org/docs/#installation).
    Once Poetry is installed, navigate to the project root directory and run:
    ```bash
    poetry install
    ```
    This will create a virtual environment (if one isn't active) and install all necessary dependencies.
    *(Note: `apollinaire-plot` is the typical package name for Apollinaire, confirm if a different one was used if issues arise.)*

## Running the Application

After installing dependencies with Poetry, you can run the application using Poetry's `run` command, which executes commands within the project's virtual environment:

```bash
poetry run bokeh serve --show iechelle/gui/main.py
```

This will typically open the application in a new browser tab.

## GUI Overview

The main interface is within the "Mode Selection" tab, which provides tools for:

*   **File Loading:**
    *   Loading observed periodograms from FITS files.
    *   Loading peak-bagging parameter files (`.pkb`).
    *   Loading background parameter files for synthetic spectrum calculation.
*   **Periodogram Display:**
    *   Interactive periodogram plot.
    *   Selection of frequency regions and modes.
    *   Thresholding for peak identification.
*   **Echelle Diagram Display:**
    *   Interactive echelle diagram.
    *   Controls for `delta Nu` (large frequency separation) via a slider.
    *   Controls for color stretch of the echelle diagram.
    *   Visualization of selected modes on the diagram.
*   **Mode Selection Tables:**
    *   Tables to display and manage selected oscillation mode frequencies and parameters.
    *   Buttons to move modes between tables (e.g., from a temporary selection to a final list).
    *   Saving and loading mode lists.
*   **Synthetic Spectrum:**
    *   Calculation and display of synthetic power spectra based on loaded parameters.
    *   Comparison with observed spectra.

## Input File Formats

*   **Periodograms:** Standard FITS files where the first extension's data contains two columns: frequency and power.
*   **Peak-bagging Files (`.pkb`):** Text files containing parameters of identified oscillation modes. These are typically generated by other tools or by saving selections within iEchelle. The format is compatible with the Apollinaire library.
*   **Background Parameter Files:** Text files containing parameters describing the background noise in the periodogram, used for synthetic spectrum generation.

## Core GUI Modules (`iechelle/gui/`)

*   **`main.py`:** The entry point for the Bokeh application. It sets up the main layout and tabs.
*   **`env.py` (`Environment` class):** A central class that holds shared data, Bokeh `ColumnDataSource` objects, figure handles, UI element states, and global parameters used across different modules of the GUI.
*   **`catalog.py` (`Catalog` class):** Manages loading and interaction with astronomical catalog data, FITS file selection, and navigation between different sources.
*   **`mode_selection.py` (`Interactive` class):** Contains the core logic for the interactive echelle diagram, periodogram analysis, mode identification, selection, and interaction with synthetic spectra. This is the most complex part of the GUI.
*   **`functions.py`:** Provides utility functions, notably `calculate_synthetic_spectrum` which uses the Apollinaire library to generate synthetic PSDs.
